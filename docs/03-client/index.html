<html>
  <head>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/base16/github.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/highlightjs-func@0.1.1/dist/func.min.js"></script>
    <script src="../assets/helpers.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon.png">
    <meta property="og:title" content="Building your first web client">
    <title>Building your first web client</title>
  </head>
  <body class="page">
    <div class="options" data-options="network" ></div>
    <nav>
      <div class="logo">
        <img src = '../assets/logo.svg' />
      <p>Tutorials</p>
      </div>
    </nav>
    <div style="display: flex;" class="main">
      <div class="rightcol">
        <div class="menu">
          <div class="selectboxes">
            
            <div class="selectbox" data-select="network">
              <h3 class="selectbox-title">Network</h3>
            <div class="selectbox-selected">
              <h3></h3>
              <img src = '../assets/arrow-down.svg' />
            </div>
            <ul class="options">
              
                <li data-value="testnet" class="option">
                <div class="option-name">
                  <h4>Testnet</h4>
                  <a href="https://ton.org/docs/develop/smart-contracts/environment/testnet">docs</a>
                </div>
                <div class="option-small">
                  <p class="pros">Pros: free to use</p>
                  <p class="cons">Cons: less reliable, requires special wallets</p>
                </div>
                </li>
              
                <li data-value="mainnet" class="option">
                <div class="option-name">
                  <h4>Mainnet</h4>
                  <a href="https://tonmon.xyz/?orgId=1&amp;refresh=5m">docs</a>
                </div>
                <div class="option-small">
                  <p class="pros">Pros: very reliable, fast, works with all wallets</p>
                  <p class="cons">Cons: not free to use (but very cheap)</p>
                </div>
                </li>
              
            </ul>
            </div>
          
          </div>
          <div class="more">
            <h3>More Tutorials</h3>
            <ul>
              <li><a href="https://ton-community.github.io/tutorials/01-wallet">01. Working with your first wallet</a></li>
              <li><a href="https://ton-community.github.io/tutorials/02-contract">02. Writing your first smart contract</a></li>
              <li><a href="https://ton-community.github.io/tutorials/03-client">03. Building your first web client</a></li>
              <li><a href="https://ton-community.github.io/tutorials/04-testing">04. Testing your first smart contract</a></li>
            </ul>
          </div>
          <div class="more">
            <h3>Help</h3>
            <ul>
              <li><a href="https://github.com/ton-community/tutorials/blob/main/HELP.md">Problems with this tutorial?</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="posts">
        
         <div class="post" data-combination="mainnet">
            <h1 id="buildingyourfirstwebclient">Building your first web client</h1>
<p>In this tutorial, we will build a simple web app to interact with the Counter contract we've just deployed.
We'll also configure it as a <a href="https://core.telegram.org/bots/webapps">Telegram Web App</a>.</p>
<h2 id="step1installtonkeeper">Step 1 - Install Tonkeeper</h2>
<p>Install Tonkeeper on your mobile device. Download it from <a href="https://tonkeeper.com/">https://tonkeeper.com/</a></p>
<h2 id="step2createareactproject">Step 2 - Create a React project</h2>
<p>Create the project using <a href="https://vitejs.dev/">vite</a> (a quick way of jumpstarting react)</p>
<pre><code>npm create vite@latest my-twa -- --template react-ts
cd my-twa
npm install
npm install ton ton-crypto ton-core
npm install @orbs-network/ton-access
</code></pre>
<h2 id="step3addnodejspolyfills">Step 3 - Add node.js polyfills</h2>
<p>We need to polyfill node.js <code>Buffer</code> in order to work with TON in the browser. </p>
<p>First, install the node.js polyfills.</p>
<pre><code>npm install vite-plugin-node-polyfills
</code></pre>
<p>Modify <code>vite.config.ts</code> so it looks like this: </p>
<pre><code class="ts language-ts">import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { nodePolyfills } from "vite-plugin-node-polyfills";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react(), nodePolyfills()],
});
</code></pre>
<h2 id="step4setuptonconnect">Step 4 - Set up TON Connect</h2>
<p>TON Connect is the dapp library to enable wallet interaction</p>
<p>Install TON Connect UI. It's still in beta, but it will handle all wallet interaction for us:</p>
<ul>
<li><p>Getting the list of Ton-Connect2 supported wallets</p></li>
<li><p>Getting the address from the wallet</p></li>
<li><p>Sending a transaction through the wallet</p></li>
</ul>
<pre><code>npm i @tonconnect/ui-react
</code></pre>
<p>Now, add a <code>tonconnect-manifest.json</code> in your <code>public</code> folder with the following contents. 
Don't worry about the broken icon for now, in your production app you will just change it to a publicly available URL of your logo.</p>
<pre><code>{
  "url": "https://telegram.org",
  "name": "My TWA",
  "iconUrl": "https://broken.png"
}
</code></pre>
<p>Push to github and take note of the raw URL for <code>tonconnect-manifest.json</code>. We will use this temporarily to enable connecting the dapp to the wallet.</p>
<p>Modify main.tsx to instruct the TON Connect provider to consume the manifest we just uploaded:</p>
<pre><code class="jsx language-jsx">import { TonConnectUIProvider } from '@tonconnect/ui-react';

ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
  &lt;TonConnectUIProvider manifestUrl="&lt;GITHUB_TONCONNECT_MANIFEST_RAW_URL"&gt;
    &lt;App /&gt;
  &lt;/TonConnectUIProvider&gt;
);
</code></pre>
<h2 id="step5connecttoyourwalletfromthewebapp">Step 5 - Connect to your wallet from the webapp</h2>
<p>Replace your <code>&lt;App/&gt;</code> code</p>
<pre><code>import { TonConnectButton } from '@tonconnect/ui-react';
...
function App() {
  return (
      &lt;div&gt;
        &lt;TonConnectButton /&gt;
      &lt;/div&gt;
  );
}
</code></pre>
<p>Run <code>npm run dev</code> and open your web app. You should be able to connect at this point with your wallet and view your address within the webapp.</p>
<h2 id="step6interactwiththecountercontract">Step 6 - Interact with the Counter contract</h2>
<p>Now we'll interact with the counter contract. First, Add to your project the <code>Counter</code> class from the previous tutorial.</p>
<p>Add the following react hooks:</p>
<p>useAsyncInitialize - Will help us initialize dependencies</p>
<pre><code>function useAsyncInitialize&lt;T&gt;(func: () =&gt; Promise&lt;T&gt;, deps: any[] = []) {
  const [state, setState] = useState&lt;T | undefined&gt;();

  useEffect(() =&gt; {
    (async () =&gt; {
      setState(await func());
    })();
  }, deps);

  return state;
}
</code></pre>
<p>useTonClient - will help us interact with TON</p>
<pre><code>function useTonClient() {
  return useAsyncInitialize(
    async () =&gt;
      new TonClient({
        endpoint: await getHttpEndpoint(),
      })
  );
}
</code></pre>
<p>useTonConnect - will expose whether we are connected with the wallet, and the Sender interface which is needed to send operations via our Counter class.</p>
<pre><code>function useTonConnect(): { sender: Sender; connected: boolean } {
  const [tonConnectUI] = useTonConnectUI();

  return {
    sender: {
      send: async (args: SenderArguments) =&gt; {
        tonConnectUI.sendTransaction({
          messages: [
            {
              address: args.to.toString(),
              amount: args.value.toString(),
              payload: args.body?.toBoc().toString("base64"),
              // TODO stateInit: args.init,
            },
          ],
          validUntil: Date.now() + 5 * 60 * 1000, // TODO
        });
      },
    },
    connected: tonConnectUI.connected,
  };
}
</code></pre>
<p>Add the useCounterContract hook, which will poll the counter value every 3 seconds and expose a function to send an increment op, using TON-Connect 2, to your wallet.</p>
<pre><code>function useCounterContract() {
  const tc = useTonClient();
  const [val, setVal] = useState&lt;null | number&gt;();
  const { sender } = useTonConnect();

  const sleep = (time: number) =&gt; new Promise((resolve) =&gt; setTimeout(resolve, time));

  const ctrct = useAsyncInitialize(async () =&gt; {
    if (!tc) return;
    const contract = new Counter(
      Address.parse(&lt;COUNTER_CONTRACT_ADDRESS&gt;)
    );
    return tc.open(contract) as OpenedContract&lt;Counter&gt;;
  }, [tc]);

  useEffect(() =&gt; {
    async function getValue() {
      if (!ctrct) return;
      setVal(null);
      const val = await ctrct.getCounter();
      setVal(Number(val));
      await sleep(3000);
      getValue();
    }
    getValue();
  }, [ctrct]);

  return {
    sendIncrement: () =&gt; {
      return ctrct?.sendIncrement(sender);
    },
    value: val,
    address: ctrct?.address.toString(),
  };
}
</code></pre>
<p>Update your App.tsx</p>
<pre><code>function App() {
  const { sendIncrement, value, address } = useCounterContract();
  const { connected } = useTonConnect();

  return (
    &lt;div className="App"&gt;
      &lt;div className="Container"&gt;
        &lt;TonConnectButton /&gt;

        &lt;div className="Card"&gt;
          &lt;b&gt;Counter Address&lt;/b&gt;
          &lt;div className="Hint"&gt;{address?.slice(0, 30) + "..."}&lt;/div&gt;
        &lt;/div&gt;

        &lt;div className="Card"&gt;
          &lt;b&gt;Value&lt;/b&gt;
          &lt;div&gt;{value ?? "Loading..."}&lt;/div&gt;
        &lt;/div&gt;
        &lt;div
          className={`Button ${connected ? "Active" : "Disabled"}`}
          onClick={() =&gt; {
            sendIncrement();
          }}
        &gt;
          Increment
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2 id="step7styletheapp">Step 7 - Style the app</h2>
<p>First, delete content of your index.css file. Then, replace the contents of your App.css file with:</p>
<pre><code class="css language-css">:root {
  --tg-theme-bg-color: #efeff3;
  --tg-theme-button-color: #63d0f9;
}

.App {
  height: 100vh;
  background-color: var(--tg-theme-bg-color);
  color: var(--tg-theme-text-color);
}

.Container {
  padding: 2rem;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  gap: 30px;
  align-items: center;
  margin: 0 auto;
  text-align: center;
}

.Button {
  background-color: var(--tg-theme-button-color);
  color: var(--tg-theme-button-text-color);
  display: inline-block;
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  width: 100%;
}

.Disabled {
  background-color: #d8d8d8;
  color: #818181;
}

.Button.Active:hover {
  filter: brightness(105%);
}

.Hint {
  color: var(--tg-theme-hint-color);
}

.Card {
  width: 100%;
  padding: 10px 20px;
  border-radius: 10px;
  background-color: white;
}

@media (prefers-color-scheme: dark) {
  :root {
    --tg-theme-bg-color: #131415;
    --tg-theme-text-color: #fff;
    --tg-theme-button-color: #32a6fb;
  }

  .Card {
    background-color: #202e3e;
  }

  .CounterValue {
    background-color: #282828;
    border-radius: 16px;
    color: white;
    padding: 10px;
  }

  .Disabled {
    background-color: #444;
    color: #818181;
  }
}
</code></pre>
<h2 id="step8incrementthecounterfromyourapp">Step 8 - Increment the counter from your app</h2>
<p>You should now have a working webapp. Run it with <code>npm run dev</code>, then connect your wallet with Tonkeeper.</p>
<p>After connecting, increment the counter and watch its value change.</p>
<h2 id="step9addthetelegramwebappsdk">Step 9 - Add the Telegram Web App SDK</h2>
<p>Add the Telegram Web App SDK, so we can get theming properties from Telegram.
In your index.html file, under the <head> tag, add:</p>
<pre><code>&lt;script src="https://telegram.org/js/telegram-web-app.js"&gt;&lt;/script&gt;
</code></pre>
<p>Create a Telegram bot.</p>
<ul>
<li><p>Go to <a href="https://t.me/botfather">botfather</a> and create a bot</p></li>
<li><p>Expose your web app using ngrok (TODO - ?)</p></li>
<li><p>Set the menu button URL:</p></li>
<li><p>In Telegram's chat with botfather, type /mybots</p></li>
<li><p>Select your bot</p></li>
<li><p>Select 'Bot Settings'</p></li>
<li><p>Select 'Menu Button'</p></li>
<li><p>Select 'Edit Menu Button URL'</p></li>
<li><p>Type your ngrok URL</p></li>
<li><p>Open your webapp within telegram and launch it</p></li>
</ul>
         </div>
        
         <div class="post" data-combination="testnet">
            <h1 id="buildingyourfirstwebclient">Building your first web client</h1>
<p>In this tutorial, we will build a simple web app to interact with the Counter contract we've just deployed.
We'll also configure it as a <a href="https://core.telegram.org/bots/webapps">Telegram Web App</a>.</p>
<h2 id="step1installtonkeeper">Step 1 - Install Tonkeeper</h2>
<p>Install Tonkeeper on your mobile device. Download it from <a href="https://tonkeeper.com/">https://tonkeeper.com/</a></p>
<p>Switch tonkeeper to testnet:</p>
<ul>
<li>Go to Settings</li>
<li>Scroll down until you see the version</li>
<li>Tap on the version 5 times quickly</li>
<li>Tap switch to testnet</li>
</ul>
<h2 id="step2createareactproject">Step 2 - Create a React project</h2>
<p>Create the project using <a href="https://vitejs.dev/">vite</a> (a quick way of jumpstarting react)</p>
<pre><code>npm create vite@latest my-twa -- --template react-ts
cd my-twa
npm install
npm install ton ton-crypto ton-core
npm install @orbs-network/ton-access
</code></pre>
<h2 id="step3addnodejspolyfills">Step 3 - Add node.js polyfills</h2>
<p>We need to polyfill node.js <code>Buffer</code> in order to work with TON in the browser. </p>
<p>First, install the node.js polyfills.</p>
<pre><code>npm install vite-plugin-node-polyfills
</code></pre>
<p>Modify <code>vite.config.ts</code> so it looks like this: </p>
<pre><code class="ts language-ts">import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { nodePolyfills } from "vite-plugin-node-polyfills";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react(), nodePolyfills()],
});
</code></pre>
<h2 id="step4setuptonconnect">Step 4 - Set up TON Connect</h2>
<p>TON Connect is the dapp library to enable wallet interaction</p>
<p>Install TON Connect UI. It's still in beta, but it will handle all wallet interaction for us:</p>
<ul>
<li><p>Getting the list of Ton-Connect2 supported wallets</p></li>
<li><p>Getting the address from the wallet</p></li>
<li><p>Sending a transaction through the wallet</p></li>
</ul>
<pre><code>npm i @tonconnect/ui-react
</code></pre>
<p>Now, add a <code>tonconnect-manifest.json</code> in your <code>public</code> folder with the following contents. 
Don't worry about the broken icon for now, in your production app you will just change it to a publicly available URL of your logo.</p>
<pre><code>{
  "url": "https://telegram.org",
  "name": "My TWA",
  "iconUrl": "https://broken.png"
}
</code></pre>
<p>Push to github and take note of the raw URL for <code>tonconnect-manifest.json</code>. We will use this temporarily to enable connecting the dapp to the wallet.</p>
<p>Modify main.tsx to instruct the TON Connect provider to consume the manifest we just uploaded:</p>
<pre><code class="jsx language-jsx">import { TonConnectUIProvider } from '@tonconnect/ui-react';

ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
  &lt;TonConnectUIProvider manifestUrl="&lt;GITHUB_TONCONNECT_MANIFEST_RAW_URL"&gt;
    &lt;App /&gt;
  &lt;/TonConnectUIProvider&gt;
);
</code></pre>
<h2 id="step5connecttoyourwalletfromthewebapp">Step 5 - Connect to your wallet from the webapp</h2>
<p>Replace your <code>&lt;App/&gt;</code> code</p>
<pre><code>import { TonConnectButton } from '@tonconnect/ui-react';
...
function App() {
  return (
      &lt;div&gt;
        &lt;TonConnectButton /&gt;
      &lt;/div&gt;
  );
}
</code></pre>
<p>Run <code>npm run dev</code> and open your web app. You should be able to connect at this point with your wallet and view your address within the webapp.</p>
<h2 id="step6interactwiththecountercontract">Step 6 - Interact with the Counter contract</h2>
<p>Now we'll interact with the counter contract. First, Add to your project the <code>Counter</code> class from the previous tutorial.</p>
<p>Add the following react hooks:</p>
<p>useAsyncInitialize - Will help us initialize dependencies</p>
<pre><code>function useAsyncInitialize&lt;T&gt;(func: () =&gt; Promise&lt;T&gt;, deps: any[] = []) {
  const [state, setState] = useState&lt;T | undefined&gt;();

  useEffect(() =&gt; {
    (async () =&gt; {
      setState(await func());
    })();
  }, deps);

  return state;
}
</code></pre>
<p>useTonClient - will help us interact with TON</p>
<pre><code>function useTonClient() {
  return useAsyncInitialize(
    async () =&gt;
      new TonClient({
        endpoint: await getHttpEndpoint({ network: "testnet" }),
      })
  );
}
</code></pre>
<p>useTonConnect - will expose whether we are connected with the wallet, and the Sender interface which is needed to send operations via our Counter class.</p>
<pre><code>function useTonConnect(): { sender: Sender; connected: boolean } {
  const [tonConnectUI] = useTonConnectUI();

  return {
    sender: {
      send: async (args: SenderArguments) =&gt; {
        tonConnectUI.sendTransaction({
          messages: [
            {
              address: args.to.toString(),
              amount: args.value.toString(),
              payload: args.body?.toBoc().toString("base64"),
              // TODO stateInit: args.init,
            },
          ],
          validUntil: Date.now() + 5 * 60 * 1000, // TODO
        });
      },
    },
    connected: tonConnectUI.connected,
  };
}
</code></pre>
<p>Add the useCounterContract hook, which will poll the counter value every 3 seconds and expose a function to send an increment op, using TON-Connect 2, to your wallet.</p>
<pre><code>function useCounterContract() {
  const tc = useTonClient();
  const [val, setVal] = useState&lt;null | number&gt;();
  const { sender } = useTonConnect();

  const sleep = (time: number) =&gt; new Promise((resolve) =&gt; setTimeout(resolve, time));

  const ctrct = useAsyncInitialize(async () =&gt; {
    if (!tc) return;
    const contract = new Counter(
      Address.parse(&lt;COUNTER_CONTRACT_ADDRESS&gt;)
    );
    return tc.open(contract) as OpenedContract&lt;Counter&gt;;
  }, [tc]);

  useEffect(() =&gt; {
    async function getValue() {
      if (!ctrct) return;
      setVal(null);
      const val = await ctrct.getCounter();
      setVal(Number(val));
      await sleep(3000);
      getValue();
    }
    getValue();
  }, [ctrct]);

  return {
    sendIncrement: () =&gt; {
      return ctrct?.sendIncrement(sender);
    },
    value: val,
    address: ctrct?.address.toString(),
  };
}
</code></pre>
<p>Update your App.tsx</p>
<pre><code>function App() {
  const { sendIncrement, value, address } = useCounterContract();
  const { connected } = useTonConnect();

  return (
    &lt;div className="App"&gt;
      &lt;div className="Container"&gt;
        &lt;TonConnectButton /&gt;

        &lt;div className="Card"&gt;
          &lt;b&gt;Counter Address&lt;/b&gt;
          &lt;div className="Hint"&gt;{address?.slice(0, 30) + "..."}&lt;/div&gt;
        &lt;/div&gt;

        &lt;div className="Card"&gt;
          &lt;b&gt;Value&lt;/b&gt;
          &lt;div&gt;{value ?? "Loading..."}&lt;/div&gt;
        &lt;/div&gt;
        &lt;div
          className={`Button ${connected ? "Active" : "Disabled"}`}
          onClick={() =&gt; {
            sendIncrement();
          }}
        &gt;
          Increment
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<h2 id="step7styletheapp">Step 7 - Style the app</h2>
<p>First, delete content of your index.css file. Then, replace the contents of your App.css file with:</p>
<pre><code class="css language-css">:root {
  --tg-theme-bg-color: #efeff3;
  --tg-theme-button-color: #63d0f9;
}

.App {
  height: 100vh;
  background-color: var(--tg-theme-bg-color);
  color: var(--tg-theme-text-color);
}

.Container {
  padding: 2rem;
  max-width: 500px;
  display: flex;
  flex-direction: column;
  gap: 30px;
  align-items: center;
  margin: 0 auto;
  text-align: center;
}

.Button {
  background-color: var(--tg-theme-button-color);
  color: var(--tg-theme-button-text-color);
  display: inline-block;
  padding: 10px 20px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  width: 100%;
}

.Disabled {
  background-color: #d8d8d8;
  color: #818181;
}

.Button.Active:hover {
  filter: brightness(105%);
}

.Hint {
  color: var(--tg-theme-hint-color);
}

.Card {
  width: 100%;
  padding: 10px 20px;
  border-radius: 10px;
  background-color: white;
}

@media (prefers-color-scheme: dark) {
  :root {
    --tg-theme-bg-color: #131415;
    --tg-theme-text-color: #fff;
    --tg-theme-button-color: #32a6fb;
  }

  .Card {
    background-color: #202e3e;
  }

  .CounterValue {
    background-color: #282828;
    border-radius: 16px;
    color: white;
    padding: 10px;
  }

  .Disabled {
    background-color: #444;
    color: #818181;
  }
}
</code></pre>
<h2 id="step8incrementthecounterfromyourapp">Step 8 - Increment the counter from your app</h2>
<p>You should now have a working webapp. Run it with <code>npm run dev</code>, then connect your wallet with Tonkeeper.</p>
<p>After connecting, increment the counter and watch its value change.</p>
<h2 id="step9addthetelegramwebappsdk">Step 9 - Add the Telegram Web App SDK</h2>
<p>Add the Telegram Web App SDK, so we can get theming properties from Telegram.
In your index.html file, under the <head> tag, add:</p>
<pre><code>&lt;script src="https://telegram.org/js/telegram-web-app.js"&gt;&lt;/script&gt;
</code></pre>
<p>Create a Telegram bot.</p>
<ul>
<li><p>Go to <a href="https://t.me/botfather">botfather</a> and create a bot</p></li>
<li><p>Expose your web app using ngrok (TODO - ?)</p></li>
<li><p>Set the menu button URL:</p></li>
<li><p>In Telegram's chat with botfather, type /mybots</p></li>
<li><p>Select your bot</p></li>
<li><p>Select 'Bot Settings'</p></li>
<li><p>Select 'Menu Button'</p></li>
<li><p>Select 'Edit Menu Button URL'</p></li>
<li><p>Type your ngrok URL</p></li>
<li><p>Open your webapp within telegram and launch it</p></li>
</ul>
         </div>
        
      </div>
    </div>
  </body>
</html>